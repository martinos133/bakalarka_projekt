// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
}

enum AdvertisementStatus {
  PENDING
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum AdvertisementType {
  SERVICE
  RENTAL
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String?
  lastName      String?
  phone         String?
  dateOfBirth   DateTime?
  gender        Gender?
  isCompany     Boolean   @default(false)
  companyName   String?
  companyId     String?   // IČO
  companyTaxId  String?   // DIČ
  address       String?
  city          String?
  postalCode    String?
  country       String?
  role          UserRole  @default(USER)
  banned        Boolean   @default(false)
  bannedUntil   DateTime?
  banReason     String?
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  advertisements Advertisement[]
  paymentsReceived Payment[] @relation("Owner")
  paymentsMade Payment[]     @relation("Renter")
  reports        Report[]    @relation("Reports")
  
  @@index([banned])
  @@index([bannedUntil])
  @@index([isCompany])
}

model Category {
  id            String      @id @default(uuid())
  name          String      @unique
  slug          String      @unique
  description   String?     @db.Text
  icon          String?
  color         String?
  isActive      Boolean     @default(true)
  parentId      String?
  parent        Category?   @relation("CategoryChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children      Category[]  @relation("CategoryChildren")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  advertisements Advertisement[]
  filters       Filter[]
  
  @@index([slug])
  @@index([isActive])
  @@index([parentId])
}

enum FilterType {
  TEXT
  NUMBER
  SELECT
  MULTISELECT
  BOOLEAN
  DATE
  RANGE
}

model Filter {
  id          String     @id @default(uuid())
  name        String
  slug        String
  type        FilterType
  categoryId  String
  category    Category   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  description String?    @db.Text
  options     String[]   // Pre SELECT a MULTISELECT typy
  isRequired  Boolean    @default(false)
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  @@unique([categoryId, slug])
  @@index([categoryId])
  @@index([isActive])
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

model Advertisement {
  id          String             @id @default(uuid())
  title       String
  description String             @db.Text
  price       Float?
  status      AdvertisementStatus @default(PENDING)
  type        AdvertisementType  @default(SERVICE)
  categoryId  String?
  category    Category?          @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  location    String?
  postalCode String?
  images      String[]
  // Service-specific fields
  pricingType String?            // 'FIXED', 'HOURLY', 'DAILY', 'PACKAGE'
  hourlyRate  Float?
  dailyRate   Float?
  packages    Json?              // Array of package objects with name, description, price, deliveryTime
  deliveryTime String?           // e.g., "3-5 dní", "1 týždeň"
  revisions   String?            // e.g., "Neobmedzené", "3 revízie"
  features    String[]           // Array of features/included items
  faq         Json?              // Array of FAQ objects with question and answer
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  userId      String
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments    Payment[]          @relation("AdvertisementOwner")
  reports     Report[]
  
  @@index([userId])
  @@index([status])
  @@index([categoryId])
  @@index([type])
}

model Payment {
  id              String         @id @default(uuid())
  advertisementId String
  advertisement   Advertisement  @relation("AdvertisementOwner", fields: [advertisementId], references: [id], onDelete: Cascade)
  renterId        String
  renter          User           @relation("Renter", fields: [renterId], references: [id], onDelete: Cascade)
  ownerId         String
  owner           User           @relation("Owner", fields: [ownerId], references: [id], onDelete: Cascade)
  amount          Float
  status          PaymentStatus  @default(PENDING)
  paymentDate     DateTime?
  startDate       DateTime?
  endDate         DateTime?
  notes           String?        @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  @@index([advertisementId])
  @@index([renterId])
  @@index([ownerId])
  @@index([status])
}

enum ReportStatus {
  PENDING
  RESOLVED
  DISMISSED
}

enum ReportReason {
  SPAM
  INAPPROPRIATE
  FAKE
  SCAM
  COPYRIGHT
  OTHER
}

model Report {
  id              String         @id @default(uuid())
  advertisementId String
  advertisement   Advertisement  @relation(fields: [advertisementId], references: [id], onDelete: Cascade)
  reporterId      String
  reporter        User           @relation("Reports", fields: [reporterId], references: [id], onDelete: Cascade)
  reason          ReportReason
  description     String?        @db.Text
  status          ReportStatus   @default(PENDING)
  resolvedBy      String?        // Admin ID
  resolvedAt      DateTime?
  resolutionNote  String?        @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  @@index([advertisementId])
  @@index([reporterId])
  @@index([status])
  @@index([createdAt])
}
